---
layout: post
title: 虚拟化技术（二）
date: 2022-10-05
tags: 云计算
---

## 操作系统虚拟化

在主机操作系统中插入虚拟化层。

### 优缺点

#### 优点

最小的启动、停止开销；资源需求低；可扩展性强

可同步虚拟机和宿主操作系统环境状态的变化

允许虚拟机中进程访问尽可能多的主机资源

#### 缺点

同一个容器中的操作系统级虚拟机必须使用相同的客户操作系统

资源隔离性较差

![](https://newtank1.github.io/assets/images/QQ截图20221005151422.png)

## 云数据中心的虚拟化

### 对象

服务器虚拟化：将物理服务器虚拟为逻辑服务器

存储虚拟化：将异构分布的存储设备统一为存储池

网格虚拟化：在底层物理网络和网络用户间增加抽象层

### 目的

一台物理设备服务多个用户，提升资源共享和复用的效率，降低成本

灵活扩展和空间分布的存储空间，提升可扩展性，提升存储资源使用效率

为了实现服务器、存储虚拟化，要求网络也能够方便、灵活调整，随着虚拟机的迁移一起迁移

### 服务器虚拟化

虚拟机与容器并存，容器的地位不断提升，目前与虚拟机相当

### 存储虚拟化

提高资源利用率，降低单位成本和管理成本。

一般模式：通过负载均衡、数据迁移、数据块重组等技术，提升系统的潜在性能，满足多种存储应用的需求；通过数据镜像、数据校验、多路径等技术，提高数据可靠性和系统可用性

具体实现：

- 基于主机：性价比高；性能低，可扩展性差、不支持异构平台
- 基于存储设备：主机无关，对系统性能影响较小，易于管理；对于包含异构存储设备的存储系统，虚拟化相关不好，设备规模有限且不能级联，可扩展性较差
- 基于网络：性能、效果和安全更好，能够支持动态多路径；路由器故障会导致主机受到影响

#### VMFS

VMware的vSphere提出的虚拟文件系统，允许多个主机同时读写同一个存储器

- 磁盘锁定技术：锁定已启动的虚拟机对应的磁盘，避免多个物理主机同时启动同一个虚拟机。
- 故障一致性和恢复机制
- 裸机映射

### 网络虚拟化

虚拟网卡、虚拟交换机、分布式虚拟交换机、端口组

核心：SDN

## 虚拟机迁移

### 内存迁移

#### Stop-and-Copy

A停机，将内存全部复制到B，启动B。

迁移时间最短，但有停机时间

#### Stop-and-Copy和Pull结合

A停机，将部分内存复制到B，启动B。B出现缺页时从A复制

停机时间短，总迁移时间长。Pull阶段复制产生虚拟下降

#### Push和Stop-and-Copy结合

A不停机，将变化地内存迭代复制到B，直到剩余很少的时候停止A，复制最后变动到B，启动B

平衡了停机时间和迁移时间的矛盾；需要有测定工作集的算法以避免反复重传；可能会占用大量网络带宽

### 网络迁移

通过发送并修改配置实现

### 存储设备迁移

以共享的方式共享数据和文件系统，而非真正迁移。

使用NAS作为存储设备共享数据